## 1 . 密钥文件登录主机
bastillion 的私钥被加密，使用前需要解密
```bash
eval "$(ssh-agent -s)"
ssh-add /home/chao.long/lc/auth/inboc-sys-lc.key
```
> [!Attention!]
> 不能断开，在相同终端执行 playbook


## 2. 定义变量
使用下划线，不能是中横线
当前被控主机 ip 变量： {{ hostvars[inventory_hostname].ansible_host }} \
指定主机 IP 变量： {{ hostvars["inboc-sys-dns-01"].ansible_host }} \
变量定义规范：
```
organization:

```

## 3. 添加仓库的 gpg key
apt-key 模块示例
```
- name: Add an apt key by id from a keyserver
  ansible.builtin.apt_key:
    keyserver: keyserver.ubuntu.com
    id: 36A1D7869245C8950F966E92D8576A8BA88D21E9

- name: Add an Apt signing key, will not download if present
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc
    state: present


# 使用装甲文件，因为需要 utf-8 字符串。必须是  "PGP PUBLIC KEY BLOCK"  类型。
- name: Add a key from a file on the Ansible server
  ansible.builtin.apt_key:
    data: "{{ lookup('file', 'apt.asc') }}"
    state: present

- name: Add an Apt signing key to a specific keyring file
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc
    keyring: /etc/apt/trusted.gpg.d/debian.gpg

- name: Add Apt signing key on remote server to keyring
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    file: /tmp/apt.gpg
    state: present

```
## 4. blockinfile 缩进问题
```
- name: insert DNS targets into prometheus  
  blockinfile:  
    path: "{{ prom_config }}"  
    marker: "# for DNS exporter"  
    block: |2   # 此处配合下文的空格，解决目标格式中的两个空格缩进要求
        - job_name: 'bind-exporter'  
          static_configs:  
          - targets: ['{{ hostvars["inboc-sys-dns-01"].ansible_host }}:9153']  
            labels:  
              alias: dns-master  
          - targets: ['{{ hostvars["inboc-sys-dns-02"].ansible_host }}:9153']  
            labels:  
              alias: dns-slave  
#    create: true
```

5 . jinja2
[如虎添翼的力量：解锁强大的Jinja2模板 | 骏马金龙](https://www.junmajinlong.com/ansible/9_power_of_jinja2/index.html)
[ Jinja2 模板语法 - Ansible wiki](https://ansible.leops.cn/basic/Jinja2/#ansible-jinja2)