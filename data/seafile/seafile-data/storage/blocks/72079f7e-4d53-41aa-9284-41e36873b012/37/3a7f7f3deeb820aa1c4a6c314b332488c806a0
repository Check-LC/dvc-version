![5.longhorn](../../../02_Kubernetes/02_03_Rancher/5.longhorn.md#2.%20metrics)

## debug
>[!bug]
>longhorn-manager service 指标出现自动发现的报错，在 pod:5101、 pod:5102 、 :5103 出现 4xx 错误。\
>因为这些端口本身不暴露指标。（首次测试下 annotation 的方式并没有出现这样的错误）\
>最终选择创建 servicemonitor

可以在 helm 直接开启 servicemonitor，或者自行新增。同时删除 longhorn-manager 的 pod annotation。

```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  annotations:
    meta.helm.sh/release-name: longhorn
    meta.helm.sh/release-namespace: longhorn-system
  labels:
    app.kubernetes.io/instance: longhorn
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: longhorn
    app.kubernetes.io/version: v1.5.4
    helm.sh/chart: longhorn-102.3.2_up1.5.4
    name: longhorn-prometheus-servicemonitor
  name: longhorn-prometheus-servicemonitor
  namespace: longhorn-system
spec:
  endpoints:
    - port: manager
  namespaceSelector:
    matchNames:
      - longhorn-system
  selector:
    matchLabels:
      app: longhorn-manager
```