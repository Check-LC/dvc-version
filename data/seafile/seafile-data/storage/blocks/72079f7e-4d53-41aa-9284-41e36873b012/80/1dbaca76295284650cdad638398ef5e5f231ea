

# minio - inboc

minio

[Xie Jian 已更新 大约 4 小时前](https://outline.inboc.net/doc/minio-rE0coIiCJt/history)  • [被浏览 3 用户](https://outline.inboc.net/doc/minio-rE0coIiCJt/insights)

MinIO 管理访问的主要方式是通过策略。我们需要对 authentik 进行配置，使其返回一个列表，列出应向用户应用哪些 MinIO 策略。

在 Customization -> Property Mappings 下，创建一个 Acops Mapping 。将其命名为 OIDC-Scope-minio。将作用域名称设置为 `minio` ，表达式设置如下

```plain
return {
    "policy": "readwrite",
}
```

这种映射会导致 MinIO `readwrite` 默认策略应用于所有用户。如果要根据 authentik 组创建更细粒度的映射，请使用如下表达式

```plain
if ak_is_group_member(request.user, name="Minio admins"):
  return {
      "policy": "consoleAdmin",
}
elif ak_is_group_member(request.user, name="Minio users"):
  return {
      "policy": ["readonly", "my-custom-policy"]
}
return None
```

请注意，您可以通过返回列表为用户分配多个策略，而返回 `None` 将不会为用户映射任何策略，从而导致无法访问 MinIO 实例。

使用以下参数创建 OAuth2/OpenID Provider：

*   Client type： `Confidential`
    
*   Scopes：OpenID、email、profile和OIDC-Scope-minio
    
*   Signing Key：选择任何可用密钥
    
*   Redirect URIs/Origins： `https://minio.company/oauth_callback`
    

注意 Client ID 和 Client Secret。

![](assets/1713432766-f8680a21b35e2bdeb71d4ea1ec82af88.png)

使用上文创建的 Provider 创建 Application，注意所创建 Application 的标题。

![](assets/1713432766-84286586f16f7f9a0c25087d095de73b.png)

使用mc客户端执行以下命令:

```plain
mc alias set test_minio https://minio.inboc.top test-admin 7OmQcWc624pRnKMhSA8z5GI5eVHezxeGNb025MUj

mc admin config set test_minio identity_openid \
config_url="https://authentik.inboc.top/application/o/minio/.well-known/openid-configuration" \
client_id="D4sCobi9N5RbbqJThTGmqsoNnB006RNMcujir2LQ" \
client_secret="bXsKqb811DgrSMXuaQrF4eNxl4DrzqP5AULeMOHrmrQLg9C440LQFOfKe77zOiy3zSxROnpsENU5ryHGtroKd4uUOb5h6dYxXxj4zmlJoh2NeGSXCngnwMxtJ3jTuJhq" \
scopes="openid,profile,email,minio"
```

注意：`Rediect URI: https://console.inboc.top/oauth_callback` 也需要填写，否则将会报错。

OIDC 上的上游 MinIO 文档指出， `client_secret` （因此保密客户机类型）是可选的，这取决于提供商。在使用单节点 MinIO 实例进行实验时，客户端机密是必需的，而且没有出现其他问题。

![](assets/1713432766-d77b26d97791bf1e6ae5a2964a22c814.png)

[反向链接](#backlinks)

[7\. 项目配置](https://outline.inboc.net/doc/7-Y6TGY95RO9#d-rE0coIiCJt)
