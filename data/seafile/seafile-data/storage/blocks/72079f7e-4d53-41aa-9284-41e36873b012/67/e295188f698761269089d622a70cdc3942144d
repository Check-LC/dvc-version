DeepFlow 基于 eBPF 实现了应用性能指标、分布式追踪、持续性能剖析等观测信号的**零侵扰**（ `Zero Code` ）采集，并结合**智能标签**（ `SmartEncoding` ）技术实现了所有观测信号的**全栈**（ `Full Stack` ）关联和高效存取。使用 DeepFlow，可以让云原生应用自动具有深度可观测性，从而消除开发者不断插桩的沉重负担，并为 DevOps/SRE 团队提供从代码到基础设施的监控及诊断能力。


步骤：
helm install


虚拟机的 agent 部署尝试
```
sudo curl -o /usr/bin/deepflow-ctl https://deepflow-ce.oss-cn-beijing.aliyuncs.com/bin/ctl/stable/linux/$(arch | sed 's|x86_64|amd64|' | sed 's|aarch64|arm64|')/deepflow-ctl
sudo chmod a+x /usr/bin/deepflow-ctl

# 创建 host domain
unset DOMAIN_NAME
DOMAIN_NAME="legacy-host"  # FIXME: domain name

cat << EOF | deepflow-ctl -i deepflow-server-hostip domain create -f -  #之后的一些命令也都需要指定这个dp-server
name: $DOMAIN_NAME
type: agent_sync
EOF

# 创建采集器组
unset AGENT_GROUP
AGENT_GROUP="legacy-host"  # FIXME: domain name

deepflow-ctl agent-group create $AGENT_GROUP
deepflow-ctl agent-group list $AGENT_GROUP # Get agent-group ID

# 创建采集器组配置文件 `agent-group-config.yaml`：

vtap_group_id: g-ffffff # FIXME: agent-group ID
platform_enabled: 1

# 创建采集器组配置：
deepflow-ctl agent-group-config create -f agent-group-config.yaml

# agent 安装
curl -O https://deepflow-ce.oss-cn-beijing.aliyuncs.com/deb/agent/stable/linux/$(arch | sed 's|x86_64|amd64|' | sed 's|aarch64|arm64|')/deepflow-agent-deb.zip
unzip deepflow-agent-deb.zip
dpkg -i x86_64/deepflow-agent-1.0*.systemd.deb

# 修改 deepflow-agent 的配置文件 `/etc/deepflow-agent.yaml` ：
controller-ips:
  - 10.1.2.3  # FIXME: K8s Node IPs
vtap-group-id-request: "g-fffffff"  # FIXME: agent-group ID

systemd 启动 deepflow-agent ：

systemctl enable deepflow-agent --now
```

